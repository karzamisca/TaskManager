<!-- views/userPages/userSalaryCalculation/userSalaryCalculation.html -->
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bảng tính lương</title>
    <link
      rel="stylesheet"
      href="userPages/userSalaryCalculation/userSalaryCalculation.css?v=1.4"
    />
  </head>
  <body>
    <!-- Header will be loaded here by headerLoader.js -->

    <div class="salary-calculation-page">
      <div class="container">
        <h1>Bảng lương</h1>

        <div class="tabs">
          <button class="tab-button active" data-tab="users">
            Danh sách nhân viên
          </button>
          <button class="tab-button" data-tab="add-user">Thêm nhân viên</button>
        </div>

        <div class="tab-content">
          <div id="users" class="tab-pane active">
            <div class="filter-section">
              <h2>Bộ lọc</h2>
              <div class="filter-form">
                <div class="form-group">
                  <label for="user-cost-center-filter"
                    >Nhân viên thuộc trạm:</label
                  >
                  <select id="user-cost-center-filter">
                    <option value="all">Tất cả trạm</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="user-manager-filter">Người quản lý:</label>
                  <select id="user-manager-filter">
                    <option value="all">Tất cả quản lý</option>
                  </select>
                </div>
                <button id="filter-button" class="btn primary">
                  Áp dụng bộ lọc
                </button>
              </div>
            </div>

            <div class="selection-controls">
              <div class="selection-header">
                <input
                  type="checkbox"
                  id="select-all-toggle"
                  class="select-all-toggle"
                />
                <label for="select-all-toggle" class="select-all-label"
                  >Chọn</label
                >
                <span style="margin-left: 15px; color: var(--light-text)">
                  Đã chọn: <span id="selected-count">0</span>
                </span>
              </div>
              <div class="export-section">
                <div
                  class="email-section"
                  style="display: flex; gap: 10px; align-items: center"
                >
                  <div style="display: flex; gap: 5px; align-items: center">
                    <label for="send-month">Tháng:</label>
                    <input
                      type="number"
                      id="send-month"
                      min="1"
                      max="12"
                      style="width: 60px; padding: 5px"
                    />
                  </div>
                  <div style="display: flex; gap: 5px; align-items: center">
                    <label for="send-year">Năm:</label>
                    <input
                      type="number"
                      id="send-year"
                      min="2020"
                      max="2030"
                      style="width: 80px; padding: 5px"
                    />
                  </div>
                  <button
                    id="send-email-btn"
                    class="btn"
                    style="background: #9c27b0"
                  >
                    Gửi Email Bảng Lương
                  </button>
                </div>
                <button id="export-xlsx-btn" class="btn btn-export">
                  Xuất Excel
                </button>
              </div>
            </div>

            <h2>Thông tin nhân viên</h2>
            <div class="table-container">
              <table id="users-table">
                <thead>
                  <tr>
                    <th class="checkbox-cell"></th>
                    <th>Tên đăng nhập</th>
                    <th>Tên thật</th>
                    <th>Email</th>
                    <th>Trạm</th>
                    <th>Người quản lý</th>
                    <th>Ngân hàng</th>
                    <th>Số tài khoản</th>
                    <th>Căn cước công dân</th>
                    <th>Lương cơ bản</th>
                    <th>Lương theo giờ</th>
                    <th>Hoa hồng</th>
                    <th>Thưởng khác</th>
                    <th>Trách nhiệm</th>
                    <th>Phụ cấp chung</th>
                    <th>Giờ tăng ca trong tuần</th>
                    <th>Giờ tăng ca Chủ Nhật</th>
                    <th>Giờ tăng ca ngày lễ</th>
                    <th>Lương tăng ca</th>
                    <th>Công tác phí</th>
                    <th>Tổng lương</th>
                    <th>Lương đóng bảo hiểm</th>
                    <th>Bảo hiểm bắt buộc</th>
                    <th>Số người phụ thuộc</th>
                    <th>Thu nhập tính thuế</th>
                    <th>Thuế thu nhập</th>
                    <th>Lương thực lĩnh</th>
                    <th>Thao tác</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="add-user" class="tab-pane">
            <h2>Thêm nhân viên mới</h2>
            <form id="add-user-form">
              <div class="form-group">
                <label for="new-username">Tên đăng nhập:</label>
                <input type="text" id="new-username" required />
              </div>
              <div class="form-group">
                <label for="new-real-name">Tên thật:</label>
                <input type="text" id="new-real-name" required />
              </div>
              <div class="form-group">
                <label for="new-email">Email:</label>
                <input type="email" id="new-email" placeholder="Nhập email" />
              </div>
              <div class="form-group">
                <label for="new-cost-center">Trạm:</label>
                <select id="new-cost-center" required></select>
              </div>
              <div class="form-group">
                <label for="new-assigned-manager">Người quản lý:</label>
                <select id="new-assigned-manager"></select>
              </div>
              <div class="form-group">
                <label for="new-beneficiary-bank">Ngân hàng:</label>
                <input type="text" id="new-beneficiary-bank" required />
              </div>
              <div class="form-group">
                <label for="new-bank-account-number">Số tài khoản:</label>
                <input type="number" id="new-bank-account-number" required />
              </div>
              <div class="form-group">
                <label for="new-citizen-id">Căn cước công dân:</label>
                <input type="number" id="new-citizen-id" required />
              </div>
              <div class="form-group">
                <label for="new-base-salary">Lương cơ bản:</label>
                <input
                  type="number"
                  id="new-base-salary"
                  min="0"
                  step="0.01"
                  required
                />
              </div>
              <div class="form-group">
                <label for="new-commission-bonus">Hoa hồng:</label>
                <input
                  type="number"
                  id="new-commission-bonus"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-other-bonus">Thưởng khác:</label>
                <input
                  type="number"
                  id="new-other-bonus"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-responsibility">Trách nhiệm:</label>
                <input
                  type="number"
                  id="new-responsibility"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-allowance-general">Phụ cấp:</label>
                <input
                  type="number"
                  id="new-allowance-general"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-weekday-overtime"
                  >Giờ tăng ca trong tuần:</label
                >
                <input
                  type="number"
                  id="new-weekday-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-weekend-overtime">Giờ tăng ca Chủ Nhật:</label>
                <input
                  type="number"
                  id="new-weekend-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-holiday-overtime">Giờ tăng ca ngày lễ:</label>
                <input
                  type="number"
                  id="new-holiday-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-travel-expense">Công tác phí:</label>
                <input
                  type="number"
                  id="new-travel-expense"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-insurable-salary">Lương đóng bảo hiểm:</label>
                <input
                  type="number"
                  id="new-insurable-salary"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="new-dependant-count">Số người phụ thuộc:</label>
                <input
                  type="number"
                  id="new-dependant-count"
                  min="0"
                  value="0"
                />
              </div>
              <button type="submit" class="btn primary">Thêm nhân viên</button>
            </form>
          </div>
        </div>

        <!-- Edit User Modal (now includes email) -->
        <div id="edit-user-modal" class="modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Chỉnh sửa thông tin nhân viên</h2>
            <form id="edit-user-form">
              <input type="hidden" id="edit-user-id" />
              <div class="form-group">
                <label for="edit-username">Tên đăng nhập:</label>
                <input type="text" id="edit-username" required />
              </div>
              <div class="form-group">
                <label for="edit-real-name">Tên thật:</label>
                <input type="text" id="edit-real-name" required />
              </div>
              <div class="form-group">
                <label for="edit-email">Email:</label>
                <input type="email" id="edit-email" placeholder="Nhập email" />
                <small style="color: var(--light-text)"
                  >Cần email để gửi bảng lương</small
                >
              </div>
              <div class="form-group">
                <label for="edit-cost-center">Trạm:</label>
                <select id="edit-cost-center" required></select>
              </div>
              <div class="form-group">
                <label for="edit-assigned-manager">Quản lý trực tiếp:</label>
                <select id="edit-assigned-manager"></select>
              </div>
              <div class="form-group">
                <label for="edit-beneficiary-bank">Ngân hàng:</label>
                <input type="text" id="edit-beneficiary-bank" required />
              </div>
              <div class="form-group">
                <label for="edit-bank-account-number">Số tài khoản:</label>
                <input type="number" id="edit-bank-account-number" required />
              </div>
              <div class="form-group">
                <label for="edit-citizen-id">Căn cước công dân:</label>
                <input type="number" id="edit-citizen-id" required />
              </div>
              <div class="form-group">
                <label for="edit-base-salary">Lương cơ bản:</label>
                <input
                  type="number"
                  id="edit-base-salary"
                  min="0"
                  step="0.01"
                  required
                />
              </div>
              <div class="form-group">
                <label for="edit-commission-bonus">Hoa hồng:</label>
                <input
                  type="number"
                  id="edit-commission-bonus"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-other-bonus">Thưởng khác:</label>
                <input
                  type="number"
                  id="edit-other-bonus"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-responsibility">Trách nhiệm:</label>
                <input
                  type="number"
                  id="edit-responsibility"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-allowance-general">Phụ cấp chung:</label>
                <input
                  type="number"
                  id="edit-allowance-general"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-weekday-overtime"
                  >Giờ tăng ca trong tuần:</label
                >
                <input
                  type="number"
                  id="edit-weekday-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-weekend-overtime">Giờ tăng ca Chủ Nhật:</label>
                <input
                  type="number"
                  id="edit-weekend-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-holiday-overtime">Giờ tăng ca ngày lễ:</label>
                <input
                  type="number"
                  id="edit-holiday-overtime"
                  min="0"
                  step="0.1"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-travel-expense">Công tác phí:</label>
                <input
                  type="number"
                  id="edit-travel-expense"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-insurable-salary">Lương đóng bảo hiểm:</label>
                <input
                  type="number"
                  id="edit-insurable-salary"
                  min="0"
                  step="0.01"
                  value="0"
                />
              </div>
              <div class="form-group">
                <label for="edit-dependant-count">Số người phụ thuộc:</label>
                <input
                  type="number"
                  id="edit-dependant-count"
                  min="0"
                  value="0"
                />
              </div>
              <button type="submit" class="btn primary">Cập nhật</button>
            </form>
          </div>
        </div>

        <!-- User History Modal -->
        <div id="user-history-modal" class="modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Lịch sử lương nhân viên</h2>
            <div
              id="history-user-info"
              style="
                margin-bottom: 20px;
                padding: 10px;
                background: var(--header-bg);
                border-radius: 4px;
              "
            >
              <p>
                <strong>Nhân viên:</strong> <span id="history-user-name"></span>
              </p>
              <p>
                <strong>Tên đăng nhập:</strong>
                <span id="history-username"></span>
              </p>
            </div>
            <div class="table-container">
              <table id="history-table">
                <thead>
                  <tr>
                    <th>Tháng</th>
                    <th>Năm</th>
                    <th>Lương cơ bản</th>
                    <th>Hoa hồng</th>
                    <th>Trách nhiệm</th>
                    <th>Thưởng khác</th>
                    <th>Phụ cấp chung</th>
                    <th>Giờ tăng ca trong tuần</th>
                    <th>Giờ tăng ca Chủ Nhật</th>
                    <th>Giờ tăng ca ngày lễ</th>
                    <th>Lương tăng ca</th>
                    <th>Công tác phí</th>
                    <th>Lương gộp</th>
                    <th>Thuế</th>
                    <th>Lương thực lĩnh</th>
                    <th>Lương đóng bảo hiểm</th>
                    <th>Bảo hiểm bắt buộc</th>
                    <th>Số người phụ thuộc</th>
                    <th>Thu nhập tính thuế</th>
                    <th>Trạm</th>
                    <th>Người quản lý</th>
                    <th>Ngày ghi nhận</th>
                  </tr>
                </thead>
                <tbody id="history-table-body"></tbody>
              </table>
            </div>
            <div style="margin-top: 20px; text-align: center">
              <button
                id="export-history-btn"
                class="btn btn-export"
                style="display: none"
              >
                Xuất lịch sử ra Excel
              </button>
            </div>
          </div>
        </div>

        <!-- Email Results Modal -->
        <div id="email-results-modal" class="modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Kết quả gửi email</h2>
            <div id="email-results-content">
              <!-- Results will be displayed here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="userPages/userSalaryCalculation/userSalaryCalculation.js?v=1.11"></script>
    <script src="/components/header/headerLoader.js?v=1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
