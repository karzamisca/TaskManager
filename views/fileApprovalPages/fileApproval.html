<!-- views/fileApprovalPages/fileApproval.html -->
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ph√™ duy·ªát t·ªáp tin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="fileApprovalPages/fileApproval.css" />
  </head>
  <body>
    <h1>Ph√™ duy·ªát t·ªáp tin</h1>

    <!-- Statistics Section -->
    <div class="stats-section" id="statsSection">
      <!-- Stats will be loaded dynamically -->
    </div>

    <!-- File Upload Section -->
    <div class="upload-section">
      <h2>T·∫£i L√™n T·ªáp tin</h2>
      <div class="upload-area" id="uploadArea">
        <p>K√©o v√† th·∫£ t·ªáp tin v√†o ƒë√¢y ho·∫∑c nh·∫•p v√†o ƒë·ªÉ ch·ªçn t·ªáp tin</p>
        <form id="uploadForm" enctype="multipart/form-data">
          <input
            type="file"
            name="file"
            id="fileInput"
            style="display: none"
            required
          />

          <!-- Category selection -->
          <div class="form-group">
            <label for="categorySelect">Ch·ªçn danh m·ª•c:</label>
            <select
              id="categorySelect"
              name="category"
              required
              onchange="updateFormFields()"
            >
              <option value="">-- Ch·ªçn danh m·ª•c --</option>
              <option value="C√¥ng ty">üìä C√¥ng ty</option>
              <option value="ƒê·ªëi t√°c">ü§ù ƒê·ªëi t√°c</option>
              <option value="Ng√¢n h√†ng">üè¶ Ng√¢n h√†ng</option>
              <option value="Ph√°p l√Ω">‚öñÔ∏è Ph√°p l√Ω</option>
            </select>
          </div>

          <!-- Year input -->
          <div class="form-group">
            <label for="yearInput">Nh·∫≠p nƒÉm:</label>
            <input
              type="number"
              id="yearInput"
              name="year"
              min="0"
              placeholder="VD: 2024, 1999, 2030"
              required
              class="year-input"
              oninput="updateFolderStructure()"
            />
          </div>

          <!-- Month selection (optional for some categories) -->
          <div class="form-group" id="monthGroup">
            <label for="monthSelect">Ch·ªçn th√°ng:</label>
            <select
              id="monthSelect"
              name="month"
              onchange="updateFolderStructure()"
            >
              <option value="">-- Ch·ªçn th√°ng (n·∫øu c·∫ßn) --</option>
              <option value="1">Th√°ng 1</option>
              <option value="2">Th√°ng 2</option>
              <option value="3">Th√°ng 3</option>
              <option value="4">Th√°ng 4</option>
              <option value="5">Th√°ng 5</option>
              <option value="6">Th√°ng 6</option>
              <option value="7">Th√°ng 7</option>
              <option value="8">Th√°ng 8</option>
              <option value="9">Th√°ng 9</option>
              <option value="10">Th√°ng 10</option>
              <option value="11">Th√°ng 11</option>
              <option value="12">Th√°ng 12</option>
            </select>
          </div>

          <!-- Company specific fields -->
          <div
            class="form-group dynamic-form-group"
            id="companySubcategoryGroup"
          >
            <label for="companySubcategorySelect">Ch·ªçn lo·∫°i t√†i li·ªáu:</label>
            <select
              id="companySubcategorySelect"
              name="companySubcategory"
              onchange="updateCompanyFields()"
            >
              <option value="">-- Ch·ªçn lo·∫°i t√†i li·ªáu --</option>
              <option value="Qu·∫£n l√Ω chung">Qu·∫£n l√Ω chung</option>
              <option value="Quy tr√¨nh & Quy ƒë·ªãnh">Quy tr√¨nh & Quy ƒë·ªãnh</option>
              <option value="Nh√¢n s·ª±">Nh√¢n s·ª±</option>
              <option value="T√†i s·∫£n & Thi·∫øt b·ªã">T√†i s·∫£n & Thi·∫øt b·ªã</option>
              <option value="CO, CQ & Manual">CO, CQ & Manual</option>
              <option value="B√°o c√°o t√†i ch√≠nh">B√°o c√°o t√†i ch√≠nh</option>
            </select>
          </div>

          <div class="form-group dynamic-form-group" id="documentSubtypeGroup">
            <label for="documentSubtypeSelect">Ch·ªçn chi ti·∫øt:</label>
            <select
              id="documentSubtypeSelect"
              name="documentSubtype"
              onchange="updateFolderStructure()"
            >
              <option value="">-- Ch·ªçn chi ti·∫øt --</option>
            </select>
          </div>

          <div class="form-group dynamic-form-group" id="departmentGroup">
            <label for="departmentInput">Ph√≤ng ban:</label>
            <input
              type="text"
              id="departmentInput"
              name="department"
              placeholder="Nh·∫≠p t√™n ph√≤ng ban"
              oninput="updateFolderStructure()"
            />
          </div>

          <div class="form-group dynamic-form-group" id="employeeNameGroup">
            <label for="employeeNameInput">T√™n nh√¢n vi√™n:</label>
            <input
              type="text"
              id="employeeNameInput"
              name="employeeName"
              placeholder="Nh·∫≠p t√™n nh√¢n vi√™n"
              oninput="updateFolderStructure()"
            />
          </div>

          <div class="form-group dynamic-form-group" id="assetTypeGroup">
            <label for="assetTypeSelect">Lo·∫°i t√†i s·∫£n:</label>
            <select
              id="assetTypeSelect"
              name="assetType"
              onchange="updateAssetFields()"
            >
              <option value="">-- Ch·ªçn lo·∫°i t√†i s·∫£n --</option>
              <option value="Tr·∫°m">Tr·∫°m</option>
              <option value="B·ªìn ch·ª©a">B·ªìn ch·ª©a</option>
              <option value="Thi·∫øt b·ªã kh√°c">Thi·∫øt b·ªã kh√°c</option>
            </select>
          </div>

          <div class="form-group dynamic-form-group" id="assetNameGroup">
            <label for="assetNameInput">T√™n t√†i s·∫£n:</label>
            <input
              type="text"
              id="assetNameInput"
              name="assetName"
              placeholder="Nh·∫≠p t√™n t√†i s·∫£n"
              oninput="updateFolderStructure()"
            />
          </div>

          <!-- Partner specific fields -->
          <div class="form-group dynamic-form-group" id="partnerNameGroup">
            <label for="partnerNameInput">T√™n ƒê·ªëi t√°c:</label>
            <input
              type="text"
              id="partnerNameInput"
              name="partnerName"
              placeholder="Nh·∫≠p t√™n ƒë·ªëi t√°c"
              oninput="updateFolderStructure()"
            />
          </div>

          <div class="form-group dynamic-form-group" id="contractTypeGroup">
            <label for="contractTypeSelect">Lo·∫°i h·ª£p ƒë·ªìng:</label>
            <select
              id="contractTypeSelect"
              name="contractType"
              onchange="updatePartnerFields()"
            >
              <option value="">-- Ch·ªçn lo·∫°i h·ª£p ƒë·ªìng --</option>
              <option value="H·ª£p ƒë·ªìng mua">H·ª£p ƒë·ªìng mua</option>
              <option value="H·ª£p ƒë·ªìng b√°n">H·ª£p ƒë·ªìng b√°n</option>
              <option value="B·∫£o h√†nh & Khi·∫øu n·∫°i">B·∫£o h√†nh & Khi·∫øu n·∫°i</option>
            </select>
          </div>

          <div class="form-group dynamic-form-group" id="contractNumberGroup">
            <label for="contractNumberInput">S·ªë h·ª£p ƒë·ªìng:</label>
            <input
              type="text"
              id="contractNumberInput"
              name="contractNumber"
              placeholder="Nh·∫≠p s·ªë h·ª£p ƒë·ªìng"
              oninput="updateFolderStructure()"
            />
          </div>

          <div class="form-group dynamic-form-group" id="documentTypeGroup">
            <label for="documentTypeSelect">Lo·∫°i t√†i li·ªáu:</label>
            <select
              id="documentTypeSelect"
              name="documentType"
              onchange="updateFolderStructure()"
            >
              <option value="">-- Ch·ªçn lo·∫°i t√†i li·ªáu --</option>
            </select>
          </div>

          <!-- Bank specific fields -->
          <div class="form-group dynamic-form-group" id="bankNameGroup">
            <label for="bankNameInput">T√™n Ng√¢n h√†ng:</label>
            <input
              type="text"
              id="bankNameInput"
              name="bankName"
              placeholder="Nh·∫≠p t√™n ng√¢n h√†ng"
              oninput="updateFolderStructure()"
            />
          </div>

          <div class="form-group dynamic-form-group" id="bankDocumentTypeGroup">
            <label for="bankDocumentTypeSelect">Lo·∫°i t√†i li·ªáu:</label>
            <select
              id="bankDocumentTypeSelect"
              name="documentType"
              onchange="updateFolderStructure()"
            >
              <option value="">-- Ch·ªçn lo·∫°i t√†i li·ªáu --</option>
            </select>
          </div>

          <!-- Legal specific fields -->
          <div
            class="form-group dynamic-form-group"
            id="legalDocumentTypeGroup"
          >
            <label for="legalDocumentTypeSelect">Lo·∫°i t√†i li·ªáu:</label>
            <select
              id="legalDocumentTypeSelect"
              name="legalDocumentType"
              onchange="updateFolderStructure()"
            >
              <option value="">-- Ch·ªçn lo·∫°i t√†i li·ªáu --</option>
            </select>
          </div>

          <!-- Folder structure display -->
          <div
            class="folder-structure"
            id="folderStructure"
            style="display: none"
          >
            <h4>üìÅ T·ªáp tin s·∫Ω ƒë∆∞·ª£c l∆∞u t·∫°i:</h4>
            <div class="folder-path" id="folderPath"></div>
          </div>

          <button
            type="button"
            class="btn btn-primary"
            onclick="document.getElementById('fileInput').click()"
          >
            Ch·ªçn T·ªáp tin
          </button>
        </form>
      </div>
      <div id="uploadMessage"></div>
    </div>

    <!-- Pending Files Section -->
    <div class="pending-files">
      <h2>T·ªáp Tin ƒêang Ch·ªù Duy·ªát</h2>
      <div class="filter-section">
        <div>
          <label
            for="pendingCategoryFilter"
            style="margin-right: 10px; font-weight: bold"
            >L·ªçc theo danh m·ª•c:</label
          >
          <select
            id="pendingCategoryFilter"
            onchange="loadPendingFiles()"
            style="padding: 8px 12px"
          >
            <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
            <option value="C√¥ng ty">C√¥ng ty</option>
            <option value="ƒê·ªëi t√°c">ƒê·ªëi t√°c</option>
            <option value="Ng√¢n h√†ng">Ng√¢n h√†ng</option>
            <option value="Ph√°p l√Ω">Ph√°p l√Ω</option>
          </select>
        </div>
        <button onclick="loadPendingFiles()" class="btn btn-primary">
          üîÑ L√†m M·ªõi Danh S√°ch
        </button>
      </div>
      <div id="pendingFilesList" style="margin-top: 20px"></div>
    </div>

    <!-- Approved Files Section -->
    <div class="approved-files">
      <h2>T·ªáp Tin ƒê√£ ƒê∆∞·ª£c Ph√™ Duy·ªát</h2>

      <!-- Permission management for admin users -->
      <div id="permissionManagement" style="display: none">
        <div class="permission-section">
          <h3>üõ°Ô∏è Qu·∫£n L√Ω Quy·ªÅn Xem T·ªáp Tin</h3>
          <div class="permission-controls">
            <div class="form-group">
              <label for="userSearch">T√¨m ki·∫øm ng∆∞·ªùi d√πng:</label>
              <input
                type="text"
                id="userSearch"
                placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng..."
                style="width: 100%; padding: 8px; margin-bottom: 10px"
                oninput="searchUsers()"
              />
            </div>
            <div id="userList" class="user-list"></div>
            <div style="margin-top: 15px">
              <button onclick="saveFilePermissions()" class="btn btn-success">
                üíæ L∆∞u Quy·ªÅn Truy C·∫≠p
              </button>
              <button
                onclick="clearFilePermissions()"
                class="btn btn-secondary"
              >
                üóëÔ∏è X√≥a T·∫•t C·∫£ Quy·ªÅn
              </button>
              <button
                onclick="closePermissionManagement()"
                class="btn btn-secondary"
              >
                ‚ùå ƒê√≥ng
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="filter-section">
        <div>
          <label
            for="approvedCategoryFilter"
            style="margin-right: 10px; font-weight: bold"
            >L·ªçc theo danh m·ª•c:</label
          >
          <select
            id="approvedCategoryFilter"
            onchange="loadApprovedFiles()"
            style="padding: 8px 12px"
          >
            <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
            <option value="C√¥ng ty">C√¥ng ty</option>
            <option value="ƒê·ªëi t√°c">ƒê·ªëi t√°c</option>
            <option value="Ng√¢n h√†ng">Ng√¢n h√†ng</option>
            <option value="Ph√°p l√Ω">Ph√°p l√Ω</option>
          </select>
        </div>

        <div id="approvedYearFilterContainer">
          <label
            for="approvedYearFilter"
            style="margin-right: 10px; font-weight: bold"
            >NƒÉm:</label
          >
          <input
            type="number"
            id="approvedYearFilter"
            min="0"
            placeholder="Nh·∫≠p nƒÉm"
            style="padding: 8px 12px; width: 120px"
            onchange="onApprovedYearChange(this.value)"
          />
        </div>

        <div id="approvedMonthFilterContainer">
          <label
            for="approvedMonthFilter"
            style="margin-right: 10px; font-weight: bold"
            >Th√°ng:</label
          >
          <select id="approvedMonthFilter" style="padding: 8px 12px">
            <option value="">T·∫•t c·∫£ th√°ng</option>
            <option value="1">Th√°ng 1</option>
            <option value="2">Th√°ng 2</option>
            <option value="3">Th√°ng 3</option>
            <option value="4">Th√°ng 4</option>
            <option value="5">Th√°ng 5</option>
            <option value="6">Th√°ng 6</option>
            <option value="7">Th√°ng 7</option>
            <option value="8">Th√°ng 8</option>
            <option value="9">Th√°ng 9</option>
            <option value="10">Th√°ng 10</option>
            <option value="11">Th√°ng 11</option>
            <option value="12">Th√°ng 12</option>
          </select>
        </div>

        <button onclick="loadApprovedFiles()" class="btn btn-primary">
          üîç L·ªçc
        </button>
        <button onclick="clearApprovedFilters()" class="btn btn-secondary">
          üîÑ X√≥a L·ªçc
        </button>
      </div>

      <div id="approvedFilesList" style="margin-top: 20px"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/components/header/headerLoader.js?v=1.0"></script>
    <script src="fileApprovalPages/fileApproval.js?v=1.0"></script>
  </body>
</html>
